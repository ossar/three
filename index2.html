<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8>
    <title>My first Three.js app</title>
    <style>
    body { margin: 0; }
    canvas { width: 100%; height: 100% }
    </style>
</head>
<body>
<script src="js/three.js"></script>
<script>

// 時間係数（日）
var kTime = 0.3;

// 距離係数（km）
var kDist = 4 / 1e+7;

// サイズ
//var kSize = 2 / 1e+6;
var kSize = kDist;
var kPlanet = 50;

// データ
var pData = {
    //          [直径        公転半径   自転    公転     色       ]
    'Sun'     : [1.392e+7  , 0        , 27.25 , 0      , 0xff8844 ],
    'Mercury' : [4.8794e+4 , 5.791e+8 , 58.62 , 87.9   , 0xdddddd ],
    'Venus'   : [1.2103e+5 , 1.082e+9 , 243   , 224.7  , 0xefefdd ],
    'Earth'   : [1.2756e+5 , 1.496e+9 , 1     , 365.24 , 0x5588ff ],
    'Moon'    : [3.4758e+4 , 3.844e+6 , 27.3  , 27.3   , 0xffff00 ],
    'Mars'    : [6.7974e+4 , 2.279e+9 , 1.026 , 686.98 , 0xff6688 ],
    'Jupiter' : [1.4298e+6 , 7.784e+9 , 0.414 , 4331.7 , 0xefefdd ],
};

var rotates = [];

// シーン
var scene = new THREE.Scene();

// カメラ
var camera = new THREE.OrthographicCamera(-800, 800, 800, -800, 0.1, 100000);
camera.position.z = 1000;
camera.position.y = -10000;
camera.lookAt(scene.position);

// レンダラ
var renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerWidth);
document.body.appendChild(renderer.domElement);

// 宇宙
var universe = new THREE.Object3D();
scene.add(universe);

var sun = generatePlanet(pData.Sun);
universe.add(sun.axis);
rotates.push(sun);

var mercury = generatePlanet(pData.Mercury, 1);
sun.axis.add(mercury.axis);
rotates.push(mercury);

var venus = generatePlanet(pData.Venus, 1);
sun.axis.add(venus.axis);
rotates.push(venus);

var earth = generatePlanet(pData.Earth, 1);
sun.axis.add(earth.axis);
rotates.push(earth);

var moon = generatePlanet(pData.Moon, 1);
earth.axis.add(moon.axis);
rotates.push(moon);

var mars = generatePlanet(pData.Mars, 1);
sun.axis.add(mars.axis);
rotates.push(mars);

var jupiter = generatePlanet(pData.Jupiter, 1);
sun.axis.add(jupiter.axis);
rotates.push(jupiter);

function generatePlanet(params, isPlanet) {

    // 座標軸
    var axis = new THREE.Object3D();
    axis.position.x = kDist * params[1];

    // 惑星本体
    var planet = new THREE.Mesh(
        new THREE.SphereGeometry(kSize * (isPlanet ? kPlanet : 1) * params[0] , 8, 8),
        new THREE.MeshBasicMaterial({ color: params[4], wireframe: true, })
    );
    planet.rotation.x = -Math.PI / 2;
    planet.rotation.reorder('ZXY');
    axis.add(planet);

    // 公転
    var quaternion = new THREE.Quaternion();
    if (params[3]) {
        quaternion.setFromAxisAngle(new THREE.Vector3(0, 0, 1), 2 * Math.PI / params[3] * kTime);
    }

    var plnt = {
        axis : axis,
        planet : planet,
        quaternion : quaternion,
        data : params,
        rotation : function() {
            if (this.data[2]) {
                this.planet.rotation.z = (this.planet.rotation.z + kTime / this.data[2]) % (2 * Math.PI);
            }
        },
        revolution : function() {
            this.axis.position.applyQuaternion(this.quaternion);
        },
    };
    return plnt;
}

// レンダーループ
function render() {
    requestAnimationFrame(render);

    // 自転・公転
    for (var i=0; i<rotates.length; i++) {
        rotates[i].rotation();
        rotates[i].revolution();
    }

    renderer.render(scene, camera);
}
render();
</script>

</body>
</html>
